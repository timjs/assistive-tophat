% !TEX root=../main.tex

\section{Symbolic TopHat}
\label{sec:symbolic}

\begin{figure*}[t]
  \begin{function}
    \signature{\Simulate : \mathrm{Tasks} \times \mathrm{States} \times [\mathrm{Inputs}]  \times \mathrm{Predicates}
      \rightarrow \powerset{\mathrm{Values} \times [\mathrm{Inputs}] \times \mathrm{Predicates}}} \\
    \Simulate(t, \sigma, I, \phi) &=&
      \bigcup \set{ \Simulate'(\True, t, I, \phi, t', \sigma', i', \phi') \mid t, \sigma \drive{} t', \sigma', i', \phi' } \\
    \addlinespace
    \signature{\Simulate' : \mathrm{Booleans} \times \mathrm{Tasks} \times [\mathrm{Inputs}] \times \mathrm{Predicates} \times \mathrm{Tasks} \times \mathrm{States} \times \mathrm{Inputs} \times \mathrm{Predicates}
      \rightarrow \powerset{\mathrm{Values} \times [\mathrm{Inputs}] \times \mathrm{Predicates}}} \\
    \Simulate'(\Again, t, I, \phi, t', i', \sigma', \phi') &=& \\
      \multicolumn{3}{L}{ \left\{
        \begin{array}{lr@{\ }c@{\ }l@{\ }c@{\ }l@{\ }c@{\ }r}
          \nothing                                                                                              & \neg\Sat(\phi'\land\phi) &&&&&&\\
          \set{(v, I\oplus[i'], \phi\land\phi')}                                                                & \Sat(\phi'\land\phi)     &\land& \Value(t',\sigma') = v &&&& \\
          \Simulate(t', \sigma', I\oplus[i'], \phi\land\phi')                                           & \Sat(\phi'\land\phi)     &\land& \Value(t',\sigma') = \bot &\land& t' \neq t &&\\
          \bigcup \set{\Simulate'(\False, t', I\oplus[i'], \phi\land\phi', t'', \sigma'', i'', \phi'')
            \mid  t',\sigma' \drive{} t'', \sigma'', i'', \phi''}                                               & \Sat(\phi'\land\phi)     &\land& \Value(t',\sigma') = \bot &\land& t' = t    &\land& \Again\\
          \nothing                                                                                              & \Sat(\phi'\land\phi)     &\land& \Value(t',\sigma') = \bot &\land& t' = t    &\land& \neg\Again
        \end{array}
        \right.}
  \end{function}
  \caption{Simulation function definition.}
  \label{fig:simulate}
\end{figure*}
